# GCVE Monitoring Module
This Terraform module creates a GCE VM where a monitoring agent will be installed to retrieve GCVE metrics.
Additionally, example monitoring dashboards can be installed.  
Reference: [GCVE - Setting up Cloud Monitoring with a standalone agent](https://cloud.google.com/vmware-engine/docs/environment/howto-cloud-monitoring-standalone)

Notes:
* Secrets must be [created in Secret Manager](https://cloud.google.com/secret-manager/docs/create-secret) containing the values for vsphere_server (fqdn), vsphere_user (must be admin) and vsphere_password.
* The standalone agent configuration will be overriden, when executing the installer (startup-)script.

<!-- BEGIN_AUTOMATED_TF_DOCS_BLOCK -->
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.3.0 |
| <a name="requirement_google"></a> [google](#requirement\_google) | >= 4.35.0 |

## Usage
Basic usage of this module is as follows:

```hcl
module "example" {
	 source  = "<module-path>"

	 # Required variables
	 gcve_region  = 
	 project  = 
	 sa_gcve_monitoring  = 
	 secret_vsphere_password  = 
	 secret_vsphere_server  = 
	 secret_vsphere_user  = 
	 subnetwork  = 
	 vm_mon_name  = 
	 vm_mon_zone  = 

	 # Optional variables
	 create_dashboards  = true
	 vm_mon_type  = "e2-small"
}
```

## Resources

| Name | Type |
|------|------|
| [google_compute_instance.vm_monitoring_gcve](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance) | resource |
| [google_monitoring_dashboard.gcve_mon_dashboards](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/monitoring_dashboard) | resource |
| [google_project_iam_member.gcve_monitoring_permissions](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/project_iam_member) | resource |
| [google_project_service.enable_destination_api](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/project_service) | resource |
| [google_service_account.sa_gcve_monitoring](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/service_account) | resource |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_create_dashboards"></a> [create\_dashboards](#input\_create\_dashboards) | Define if sample GCVE monitoring dashboards should be installed | `bool` | `true` | no |
| <a name="input_gcve_region"></a> [gcve\_region](#input\_gcve\_region) | Region where the Private Cloud is deployed | `string` | n/a | yes |
| <a name="input_project"></a> [project](#input\_project) | The GCP project that will be used for GCVE monitoring | `string` | n/a | yes |
| <a name="input_sa_gcve_monitoring"></a> [sa\_gcve\_monitoring](#input\_sa\_gcve\_monitoring) | Service account for GCVE monitoring agent | `string` | n/a | yes |
| <a name="input_secret_vsphere_password"></a> [secret\_vsphere\_password](#input\_secret\_vsphere\_password) | The secret name containing the password for the vCenter admin user | `string` | n/a | yes |
| <a name="input_secret_vsphere_server"></a> [secret\_vsphere\_server](#input\_secret\_vsphere\_server) | The secret name conatining the FQDN of the vSphere vCenter server | `string` | n/a | yes |
| <a name="input_secret_vsphere_user"></a> [secret\_vsphere\_user](#input\_secret\_vsphere\_user) | The secret name containing the user for the vCenter server. Must be an admin user | `string` | n/a | yes |
| <a name="input_subnetwork"></a> [subnetwork](#input\_subnetwork) | Subnetwork where the VM will be deployed to | `string` | n/a | yes |
| <a name="input_vm_mon_name"></a> [vm\_mon\_name](#input\_vm\_mon\_name) | GCE VM name where GCVE monitoring agent will run | `string` | n/a | yes |
| <a name="input_vm_mon_type"></a> [vm\_mon\_type](#input\_vm\_mon\_type) | GCE VM machine type | `string` | `"e2-small"` | no |
| <a name="input_vm_mon_zone"></a> [vm\_mon\_zone](#input\_vm\_mon\_zone) | GCP zone where GCE VM will be deployed | `string` | n/a | yes |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_gcve_mon_dashboards"></a> [gcve\_mon\_dashboards](#output\_gcve\_mon\_dashboards) | GCVE Monitoring Dashboards resources |
| <a name="output_google_service_account"></a> [google\_service\_account](#output\_google\_service\_account) | The resource object of the service account for GCVE monitoring |
| <a name="output_vm_monitoring_gcve"></a> [vm\_monitoring\_gcve](#output\_vm\_monitoring\_gcve) | The resource object of the VM used for GCVE monitoring |

<!-- END_AUTOMATED_TF_DOCS_BLOCK -->
