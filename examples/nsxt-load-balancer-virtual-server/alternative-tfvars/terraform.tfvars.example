/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

nsxt_load_balancer_virtual_server_config = {
  display_name                = "example-virtual-server",
  enabled                     = true,
  access_log_enabled          = true,
  log_significant_event_only  = true,
  ip_address                  = "192.168.1.100",
  ports                       = [
    80
  ],
  default_pool_member_ports   = [
    80
  ],
  persistence_profile_path    = "foo",
  max_concurrent_connections  = 10,
  max_new_connection_rate     = 20,
  tags                        = {
    env             = "dev"
  },
  access_list_control         = {
    enabled     = false,
    action      = "ALLOW",
    group_path = "foo_path", 
  }
  client_ssl                  = {
    default_certificate_path  = "/infra/certificates/example.com",
    client_auth               = "IGNORE",
    certificate_chain_depth   = 3,
    ca_paths                  = [
     "/infra/certificates/ca-example",
     "/infra/certificates/ca-otherexample"
    ],
    ssl_profile_path          = "/infra/lb-client-ssl-profiles/default-high-security-client-ssl-profile"
  },
  server_ssl                  = {
    client_certificate_path   = "/infra/certificates/example.com",
    server_auth               = "IGNORE",
    certificate_chain_depth   = 3,
    ca_paths                  = [
      "/infra/certificates/ca-example",
      "/infra/certificates/ca-otherexample"
    ],
    ssl_profile_path          = "/infra/lb-server-ssl-profiles/default-high-security-server-ssl-profile"
  }
  rules = {
      example_rule = {
        match_strategy = "ALL",
        phase = "HTTP_FORWARDING",
        conditions = [
          {
            http_request_method = {
              method = "GET",
              inverse: false,
            }
          }
        ],
        actions = [
          {
            http_redirect = {
              redirect_status = 301,
              redirect_url: "http://example.com",
            }
          }
        ],
      }
    }
}
